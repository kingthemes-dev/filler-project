"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3091],{33091:(e,t,s)=>{s.r(t),s.d(t,{default:()=>b});var r=s(54568),a=s(7620),i=s(39109),l=s(86660),c=s(3346);let n=(0,s(92068).A)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var o=s(72116),d=s(12598),m=s(14486);class h{constructor(){this.baseUrl="/api/woocommerce"}async getAllCategories(){try{let e=await fetch(`${this.baseUrl}?endpoint=products/categories&per_page=100`);if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);let t=await e.json();return Array.isArray(t)?t:t.categories||[]}catch(e){return console.error("Error fetching categories:",e),[]}}async getAllAttributes(){try{let e=await fetch(`${this.baseUrl}?endpoint=products/attributes&per_page=100`);if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);let t=await e.json();return Array.isArray(t)?t:t.attributes||[]}catch(e){return console.error("Error fetching attributes:",e),[]}}async getAttributeTerms(e){try{let t=await fetch(`${this.baseUrl}?endpoint=products/attributes/${e}/terms&per_page=100`);if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);let s=await t.json();return Array.isArray(s)?s:s.terms||[]}catch(t){return console.error(`Error fetching terms for attribute ${e}:`,t),[]}}buildCategoryHierarchy(e){let t=e.sort((e,t)=>e.parent!==t.parent?e.parent-t.parent:e.id-t.id),s=new Map,r=[];return t.forEach(e=>{let t={id:e.slug,name:e.name,slug:e.slug,count:e.count,parent:e.parent,level:0,subcategories:[],description:e.description,image:e.image};s.set(e.id,t)}),t.forEach(e=>{let t=s.get(e.id);if(t)if(0===e.parent)t.level=0,r.push(t);else{let a=s.get(e.parent);a?(t.level=a.level+1,a.subcategories.push(t)):(t.level=0,r.push(t))}}),r}async getDynamicFilters(){try{let[e,t]=await Promise.all([this.getAllCategories(),this.getAllAttributes()]),s=this.buildCategoryHierarchy(e),r={};for(let e of t){let t=await this.getAttributeTerms(e.id);r[e.slug]={name:e.name,slug:e.slug,terms:t}}return{categories:s,attributes:r}}catch(e){return console.error("Error fetching dynamic filters:",e),{categories:[],attributes:{}}}}async getCategoriesWithCounts(e={}){try{let t=await this.getAllCategories();if(!e.category&&!e.search&&!e.attributes&&!e.minPrice&&!e.maxPrice&&!e.onSale)return this.buildCategoryHierarchy(t);let s=new URLSearchParams;s.append("endpoint","shop"),s.append("per_page","1"),e.search&&s.append("search",e.search),e.minPrice&&s.append("min_price",e.minPrice.toString()),e.maxPrice&&s.append("max_price",e.maxPrice.toString()),e.onSale&&s.append("on_sale","true");let r=await fetch(`${this.baseUrl}?${s.toString()}`),a=await r.json();if(a.categories)return this.buildCategoryHierarchy(a.categories);return this.buildCategoryHierarchy(t)}catch(t){console.error("Error fetching categories with counts:",t);let e=await this.getAllCategories();return this.buildCategoryHierarchy(e)}}}let u=new h;function x({onCategoryChange:e,selectedCategories:t,totalProducts:s}){let[c,n]=(0,a.useState)([]),[o,d]=(0,a.useState)(!0),[h,x]=(0,a.useState)(new Set);(0,a.useEffect)(()=>{g()},[]);let g=async()=>{try{d(!0);let e=await u.getDynamicFilters();n(e.categories)}catch(e){console.error("❌ Error loading dynamic categories:",e)}finally{d(!1)}},b=e=>h.has(e),p=e=>t.includes(e);return o?(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-2"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})}):(0,r.jsxs)("div",{className:"space-y-2",children:[c.map(t=>(0,r.jsxs)("div",{className:"border border-gray-100 rounded-lg overflow-hidden",children:[(0,r.jsx)("div",{className:"bg-gray-50",children:(0,r.jsxs)("div",{className:"flex items-center p-2 sm:p-3",children:[t.subcategories.length>0&&(0,r.jsx)("button",{onClick:()=>{var e;return e=t.id,void x(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},className:"flex items-center justify-center w-6 h-6 rounded hover:bg-gray-200 transition-colors mr-2",children:(0,r.jsx)(l.P.div,{animate:{rotate:90*!!b(t.id)},transition:{duration:.2},children:(0,r.jsx)(m.A,{className:"w-4 h-4 text-gray-500"})})}),(0,r.jsxs)("label",{className:"flex items-center flex-1 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",name:"categories",value:t.slug,checked:p(t.slug),onChange:()=>e(t.slug),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500 rounded"}),(0,r.jsx)("span",{className:"ml-3 text-xs sm:text-sm font-semibold text-gray-800",children:t.name}),(0,r.jsxs)("span",{className:"ml-auto text-xs text-gray-500",children:["(",t.count,")"]})]})]})}),(0,r.jsx)(i.N,{children:b(t.id)&&t.subcategories.length>0&&(0,r.jsx)(l.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden bg-white",children:(0,r.jsx)("div",{className:"border-t border-gray-100",children:t.subcategories.map((s,a)=>(0,r.jsxs)(l.P.label,{className:"flex items-center p-2 sm:p-3 pl-8 hover:bg-gray-50 cursor-pointer transition-colors border-b border-gray-50 last:border-b-0",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*a},children:[(0,r.jsx)("input",{type:"checkbox",name:"categories",value:s.slug,checked:p(s.slug),onChange:()=>e(t.slug,s.slug),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500 rounded"}),(0,r.jsx)("span",{className:"ml-3 text-xs sm:text-sm font-medium text-gray-700",children:s.name}),(0,r.jsxs)("span",{className:"ml-auto text-xs text-gray-500",children:["(",s.count,")"]})]},s.id))})})})]},t.id)),0===c.length&&!o&&(0,r.jsx)("div",{className:"text-center py-4",children:(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Brak kategorii do wyświetlenia"})})]})}function g({onFilterChange:e,selectedFilters:t,totalProducts:s,currentFilters:c={categories:[]}}){let[d,m]=(0,a.useState)({}),[h,u]=(0,a.useState)(!0),[x,g]=(0,a.useState)(!1),[b,p]=(0,a.useState)(new Set),[y,j]=(0,a.useState)("");(0,a.useEffect)(()=>{let e=JSON.stringify({categories:c.categories.sort(),search:c.search,minPrice:c.minPrice,maxPrice:c.maxPrice,attributes:Object.keys(t).filter(e=>e.startsWith("pa_")).sort()});e!==y&&(f(),j(e))},[c]);let f=async()=>{try{Object.keys(d).length>0?g(!0):u(!0);let e=new URLSearchParams;e.append("endpoint","shop"),e.append("per_page","100"),c.categories.length>0&&e.append("category",c.categories.join(",")),c.search&&e.append("search",c.search),void 0!==c.minPrice&&e.append("min_price",c.minPrice.toString()),void 0!==c.maxPrice&&e.append("max_price",c.maxPrice.toString()),c.attributeValues&&Object.keys(c.attributeValues).forEach(t=>{if(t.startsWith("pa_")&&c.attributeValues[t]){let s=t.replace("pa_",""),r=c.attributeValues[t];(Array.isArray(r)?r:[String(r)]).forEach(t=>{e.append(`attribute_${s}`,t)})}});let t=await fetch(`/api/woocommerce?${e.toString()}`);if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);let s=await t.json();if(s.success&&s.products){let e={};s.products.forEach(t=>{t.attributes&&Array.isArray(t.attributes)&&t.attributes.forEach(t=>{let s=t.slug?.replace("pa_","")||t.name?.toLowerCase().replace(/\s+/g,"-");s&&t.options&&Array.isArray(t.options)&&(e[s]||(e[s]={name:t.name||s,slug:s,terms:[]}),t.options.forEach(t=>{let r=t.slug||t.name?.toLowerCase().replace(/\s+/g,"-");if(r){let a=e[s].terms.find(e=>e.slug===r);a?a.count++:e[s].terms.push({id:t.id||0,name:t.name||r,slug:r,count:1})}}))})}),m(e)}else m({})}catch(e){console.error("❌ Error loading dynamic attributes:",e),m({})}finally{u(!1),g(!1)}},N=e=>b.has(e);if(h)return(0,r.jsx)("div",{className:"space-y-4",children:[void 0,void 0].map((e,t)=>(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/3 mb-2"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"h-3 bg-gray-200 rounded w-2/3"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]})]},t))});let w=Object.entries(d);return 0===w.length?(0,r.jsx)("div",{className:"text-center py-4",children:(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Brak atrybut\xf3w do wyświetlenia"})}):(0,r.jsxs)("div",{className:"space-y-4 relative",children:[x&&(0,r.jsx)("div",{className:"absolute top-0 right-0 z-10",children:(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-black rounded-full animate-spin"})}),w.map(([s,a])=>(0,r.jsxs)("div",{className:"border border-gray-100 rounded-lg overflow-hidden",children:[(0,r.jsx)("div",{className:"bg-gray-50",children:(0,r.jsxs)("button",{onClick:()=>{p(e=>{let t=new Set(e);return t.has(s)?t.delete(s):t.add(s),t})},className:"flex items-center justify-between w-full p-3 hover:bg-gray-100 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"text-sm font-semibold text-gray-800",children:a.name}),(0,r.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",a.terms.length,")"]})]}),N(s)?(0,r.jsx)(n,{className:"w-4 h-4 text-gray-500"}):(0,r.jsx)(o.A,{className:"w-4 h-4 text-gray-500"})]})}),(0,r.jsx)(i.N,{children:N(s)&&(0,r.jsx)(l.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden bg-white",children:(0,r.jsx)("div",{className:"border-t border-gray-100",children:a.terms.filter(e=>e.count>0).sort((e,t)=>t.count-e.count).map((a,i)=>(0,r.jsxs)(l.P.label,{className:"flex items-center p-2 sm:p-3 hover:bg-gray-50 cursor-pointer transition-colors border-b border-gray-50 last:border-b-0",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*i},children:[(0,r.jsx)("input",{type:"checkbox",name:s,value:a.slug,checked:((e,s)=>{let r=t[`pa_${e}`];return(Array.isArray(r)?r:[]).includes(s)})(s,a.slug),onChange:()=>((s,r)=>{let a=t[`pa_${s}`],i=Array.isArray(a)?a:[];e(`pa_${s}`,(i.includes(r)?i.filter(e=>e!==r):[...i,r]).join(","))})(s,a.slug),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500 rounded"}),(0,r.jsx)("span",{className:"ml-3 text-xs sm:text-sm font-medium text-gray-700",children:a.name}),(0,r.jsxs)("span",{className:"ml-auto text-xs text-gray-500",children:["(",a.count,")"]})]},a.id))})})})]},s))]})}function b({categories:e,filters:t,onFilterChange:s,onCategoryChange:m,onClearFilters:h,showFilters:u,onToggleFilters:b,totalProducts:p,attributesLoading:y,wooCommerceCategories:j,products:f=[]}){let[N,w]=(0,a.useState)({categories:!0,attributes:!0,price:!0,availability:!0}),v=e=>{w(t=>({...t,[e]:!t[e]}))};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"lg:hidden mb-4",children:(0,r.jsxs)("button",{onClick:b,className:"w-full flex items-center justify-between p-4 bg-white border border-gray-200 rounded-xl hover:bg-gray-50 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(c.A,{className:"w-4 h-4 mr-2"}),(0,r.jsx)("span",{className:"font-medium",children:"Filtry"})]}),u?(0,r.jsx)(n,{className:"w-4 h-4"}):(0,r.jsx)(o.A,{className:"w-4 h-4"})]})}),(0,r.jsx)("div",{className:`${u?"block":"hidden lg:block"} lg:sticky lg:top-24 lg:self-start`,children:(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-2xl p-4 sm:p-6 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(c.A,{className:"w-4 h-4 sm:w-5 sm:h-5 mr-2 text-gray-600"}),(0,r.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Filtry"}),(0,r.jsxs)("span",{className:"ml-2 text-xs sm:text-sm text-gray-500",children:["(",p," produkt\xf3w)"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:h,className:"text-xs sm:text-sm text-gray-500 hover:text-gray-700 px-2 py-1 rounded-lg hover:bg-gray-100 transition-colors",children:"Wyczyść"}),(0,r.jsx)("button",{onClick:b,className:"lg:hidden p-1 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(d.A,{className:"w-4 h-4"})})]})]}),(0,r.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,r.jsxs)("button",{onClick:()=>v("categories"),className:"flex items-center justify-between w-full mb-3 sm:mb-4",children:[(0,r.jsx)("h4",{className:"text-sm sm:text-base font-semibold text-gray-900",children:"Kategorie"}),N.categories?(0,r.jsx)(n,{className:"w-4 h-4 text-gray-500"}):(0,r.jsx)(o.A,{className:"w-4 h-4 text-gray-500"})]}),(0,r.jsx)(i.N,{children:N.categories&&(0,r.jsx)(l.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:(0,r.jsx)(x,{onCategoryChange:m,selectedCategories:t.categories,totalProducts:p})})})]}),(0,r.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,r.jsxs)("button",{onClick:()=>v("attributes"),className:"flex items-center justify-between w-full mb-3 sm:mb-4",children:[(0,r.jsx)("h4",{className:"text-sm sm:text-base font-semibold text-gray-900",children:"Atrybuty"}),N.attributes?(0,r.jsx)(n,{className:"w-4 h-4 text-gray-500"}):(0,r.jsx)(o.A,{className:"w-4 h-4 text-gray-500"})]}),(0,r.jsx)(i.N,{children:N.attributes&&(0,r.jsx)(l.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},children:(0,r.jsx)(g,{onFilterChange:s,selectedFilters:t,totalProducts:p,currentFilters:{categories:t.categories,search:t.search,minPrice:t.minPrice,maxPrice:t.maxPrice,attributes:Object.keys(t).filter(e=>e.startsWith("pa_")),attributeValues:Object.keys(t).filter(e=>e.startsWith("pa_")).reduce((e,s)=>(e[s]=t[s],e),{})}})})})]}),(0,r.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,r.jsxs)("button",{onClick:()=>v("price"),className:"flex items-center justify-between w-full mb-3 sm:mb-4",children:[(0,r.jsx)("h4",{className:"text-sm sm:text-base font-semibold text-gray-900",children:"Zakres cen"}),N.price?(0,r.jsx)(n,{className:"w-4 h-4 text-gray-500"}):(0,r.jsx)(o.A,{className:"w-4 h-4 text-gray-500"})]}),(0,r.jsx)(i.N,{children:N.price&&(0,r.jsx)(l.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"space-y-4",children:(0,r.jsx)("div",{className:"space-y-3",children:(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Od (zł)"}),(0,r.jsx)("input",{type:"number",placeholder:"0",value:t.minPrice?t.minPrice:"",onChange:e=>s("minPrice",Number(e.target.value)||0),className:"w-full px-2 sm:px-3 py-2 border border-gray-300 rounded-lg text-xs sm:text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Do (zł)"}),(0,r.jsx)("input",{type:"number",placeholder:"9999",value:t.maxPrice?t.maxPrice:"",onChange:e=>s("maxPrice",Number(e.target.value)||999999),className:"w-full px-2 sm:px-3 py-2 border border-gray-300 rounded-lg text-xs sm:text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})})})})]}),(0,r.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,r.jsxs)("button",{onClick:()=>v("availability"),className:"flex items-center justify-between w-full mb-3 sm:mb-4",children:[(0,r.jsx)("h4",{className:"text-sm sm:text-base font-semibold text-gray-900",children:"Oferty specjalne"}),N.availability?(0,r.jsx)(n,{className:"w-4 h-4 text-gray-500"}):(0,r.jsx)(o.A,{className:"w-4 h-4 text-gray-500"})]}),(0,r.jsx)(i.N,{children:N.availability&&(0,r.jsx)(l.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"space-y-3",children:(0,r.jsxs)("label",{className:`flex items-center p-3 sm:p-4 rounded-lg cursor-pointer transition-all duration-200 border-2 ${t.onSale?"bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200 shadow-sm":"hover:bg-gradient-to-r hover:from-gray-50 hover:to-gray-100 border-transparent hover:border-gray-200"}`,children:[(0,r.jsx)("input",{type:"checkbox",checked:t.onSale,onChange:e=>s("onSale",e.target.checked),className:"w-5 h-5 text-blue-600 border-2 border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200"}),(0,r.jsxs)("div",{className:"ml-3 sm:ml-4",children:[(0,r.jsx)("span",{className:`text-xs sm:text-sm font-semibold ${t.onSale?"text-blue-700":"text-gray-700"}`,children:"Promocje"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:"Produkty w promocji"})]})]})})})]})]})})]})}}}]);