(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9791],{8590:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var s=a(54568),r=a(7620),i=a(86660),o=a(75892),n=a(63072),l=a(28683),c=a(38391),d=a(82078),u=a(13719),m=a(27541),p=a(52059);function g(){let e=(0,m.useRouter)(),{user:t,isAuthenticated:a}=(0,u.n)(),[g,h]=(0,r.useState)([]),[x,y]=(0,r.useState)(!0),[b,w]=(0,r.useState)(null);(0,r.useEffect)(()=>{let t=setTimeout(()=>{a||e.push("/")},100);return()=>clearTimeout(t)},[a,e]),(0,r.useEffect)(()=>{a&&t?.id&&f()},[a,t?.id]);let f=async()=>{try{y(!0);let e=await fetch(`/api/woocommerce?endpoint=orders&customer=${t?.id}&status=completed,processing,pending`),a=await e.json();if(Array.isArray(a)){let e=a.filter(e=>e.meta_data?.some(e=>"_invoice_generated"===e.key&&"yes"===e.value)).map(e=>{let t=e.meta_data?.find(e=>"_invoice_number"===e.key)?.value,a=e.meta_data?.find(e=>"_invoice_date"===e.key)?.value;return{id:e.id.toString(),number:t||`FV/${e.id}`,date:a||e.date_created,total:100*parseFloat(e.total),currency:e.currency||"PLN",status:e.status,download_url:`https://qvwltjhdjw.cfolks.pl/?action=generate_wpo_wcpdf&document_type=invoice&order_ids=${e.id}`}});h(e)}else{let e=await fetch(`/api/woocommerce?endpoint=customers/invoices&customer_id=${t?.id}`),a=await e.json();if(a.success&&Array.isArray(a.invoices)){let e=a.invoices.map(e=>({id:e.id.toString(),number:e.number,date:e.date,total:100*parseFloat(e.total),currency:e.currency||"PLN",status:e.status,download_url:e.download_url}));h(e)}else console.error("Error fetching invoices:",a?.error||a?.message||"Nie udało się pobrać faktur"),h([])}}catch(e){console.error("Error fetching invoices:",e?.message||e),h([])}finally{y(!1)}},j=e=>(e/100).toFixed(2),N=async e=>{try{if(e.download_url)window.open(e.download_url,"_blank");else{let t=`https://qvwltjhdjw.cfolks.pl/?action=generate_wpo_wcpdf&document_type=invoice&order_ids=${e.id}`;window.open(t,"_blank")}}catch(e){console.error("Error opening invoice:",e)}},v=e=>{((e,t)=>{let a=new p.Ay,s="#000000",r="#666666",i=20;a.setFontSize(24),a.setFont("helvetica","bold"),a.setTextColor(s),a.text("Faktura",20,i),i+=10,a.setFontSize(12),a.setFont("helvetica","normal"),a.setTextColor(r),a.text(`Nr: ${e.number}`,20,i),i+=10,a.text(`Data: ${new Date(e.date).toLocaleDateString("pl-PL")}`,20,i),i+=30,a.setFontSize(14),a.setFont("helvetica","bold"),a.setTextColor(s),a.text("KingBrand Sp. z o.o.",20,i),i+=8,a.setFontSize(10),a.setFont("helvetica","normal"),a.setTextColor(r),a.text("ul. Przykładowa 123",20,i),i+=5,a.text("00-001 Warszawa",20,i),i+=5,a.text("NIP: 1234567890",20,i),i+=5,a.text("Tel: +48 123 456 789",20,i),i+=5,a.text("Email: info@kingbrand.pl",20,i),i+=20,a.setFillColor("#f5f5f5"),a.rect(20,i-5,170,10,"F"),a.setFontSize(10),a.setFont("helvetica","bold"),a.setTextColor(s),a.text("Opis",25,i),a.text("Ilość",120,i),a.text("Cena",140,i),a.text("Wartość",170,i),i+=15,[{name:"Produkt KingBrand",quantity:1,price:(e.total/100).toFixed(2)}].forEach(t=>{a.setFont("helvetica","normal"),a.setTextColor(r),a.text(t.name||"Produkt",25,i),a.text(t.quantity?.toString()||"1",120,i),a.text(`${t.price||(e.total/100).toFixed(2)} PLN`,140,i);let s=(parseFloat(t.price||(e.total/100).toString())*(t.quantity||1)).toFixed(2);a.text(`${s} PLN`,170,i),i+=8}),i+=10,a.setFontSize(12),a.setFont("helvetica","bold"),a.setTextColor(s),a.text(`RAZEM: ${(e.total/100).toFixed(2)} PLN`,140,i),i+=30,a.setFontSize(8),a.setFont("helvetica","normal"),a.setTextColor(r),a.text("Dziękujemy za zakup w KingBrand!",20,i),i+=5,a.text("Wszystkie produkty są oryginalne i pochodzą z autoryzowanych źr\xf3deł.",20,i);let o=`faktura_${e.number.replace(/[^a-zA-Z0-9]/g,"_")}.pdf`;a.save(o)})(e)};return x?(0,s.jsx)("div",{className:"min-h-screen bg-white",children:(0,s.jsx)("div",{className:"max-w-[95vw] mx-auto px-6 py-8 pb-16",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-black mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Ładowanie faktur..."})]})})}):(0,s.jsx)("div",{className:"min-h-screen bg-white",children:(0,s.jsxs)("div",{className:"max-w-[95vw] mx-auto px-6 py-8 pb-16",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl lg:text-4xl font-bold text-gray-900 mb-4",children:"Moje faktury"}),(0,s.jsx)("p",{className:"text-lg text-gray-600",children:"Historia Twoich faktur i możliwość ich pobrania"})]}),0===g.length?(0,s.jsxs)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-16",children:[(0,s.jsx)("div",{className:"mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6",children:(0,s.jsx)(o.A,{className:"w-12 h-12 text-gray-400"})}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Brak faktur"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Nie masz jeszcze żadnych faktur. Faktury pojawią się tutaj po złożeniu pierwszego zam\xf3wienia."}),(0,s.jsx)("button",{onClick:()=>e.push("/sklep"),className:"bg-black text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-800 transition-colors",children:"Przejdź do sklepu"})]}):(0,s.jsx)("div",{className:"space-y-4",children:g.map((e,t)=>{let a=(e=>{switch(e){case"completed":return{label:"Zapłacona",color:"bg-green-100 text-green-800"};case"processing":return{label:"W trakcie",color:"bg-blue-100 text-blue-800"};case"pending":return{label:"Oczekująca",color:"bg-yellow-100 text-yellow-800"};default:return{label:"Nieznana",color:"bg-gray-100 text-gray-800"}}})(e.status);return(0,s.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(o.A,{className:"w-5 h-5 text-gray-400"}),(0,s.jsxs)("span",{className:"font-semibold text-gray-900",children:["Faktura ",e.number]})]}),(0,s.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.color}`,children:a.label})]}),(0,s.jsxs)("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(n.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:new Date(e.date).toLocaleDateString("pl-PL")})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(l.A,{className:"w-4 h-4"}),(0,s.jsxs)("span",{children:[j(e.total)," ",e.currency]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("button",{onClick:()=>N(e),className:"flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-black hover:bg-gray-50 rounded-lg transition-colors",children:[(0,s.jsx)(c.A,{className:"w-4 h-4"}),"Podgląd"]}),(0,s.jsxs)("button",{onClick:()=>v(e),className:"flex items-center gap-2 px-4 py-2 bg-black text-white hover:bg-gray-800 rounded-lg transition-colors",children:[(0,s.jsx)(d.A,{className:"w-4 h-4"}),"Pobierz PDF"]})]})]})},e.id)})}),b&&(0,s.jsxs)(i.P.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[(0,s.jsx)(i.P.div,{className:"absolute inset-0 bg-black/50 backdrop-blur-[2px]",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>w(null)}),(0,s.jsxs)(i.P.div,{className:"relative bg-white rounded-2xl shadow-xl w-full max-w-2xl mx-auto max-h-[90vh] overflow-y-auto",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.2},children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,s.jsxs)("h2",{className:"text-2xl font-bold text-gray-900",children:["Faktura ",b.number]}),(0,s.jsx)("button",{onClick:()=>w(null),className:"text-gray-400 hover:text-gray-600 transition-colors",children:"\xd7"})]}),(0,s.jsx)("div",{className:"p-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Data wystawienia"}),(0,s.jsx)("p",{className:"text-gray-900",children:new Date(b.date).toLocaleDateString("pl-PL")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Kwota"}),(0,s.jsxs)("p",{className:"text-gray-900 font-semibold",children:[j(b.total)," ",b.currency]})]})]}),(0,s.jsx)("div",{className:"pt-4",children:(0,s.jsx)("p",{className:"text-gray-600",children:"Szczeg\xf3łowe informacje o fakturze będą dostępne po implementacji pełnego systemu PDF."})})]})}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200",children:[(0,s.jsx)("button",{onClick:()=>w(null),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Zamknij"}),(0,s.jsx)("button",{onClick:()=>v(b),className:"px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors",children:"Pobierz PDF"})]})]})]})]})})}},10157:(e,t,a)=>{Promise.resolve().then(a.bind(a,8590))},13719:(e,t,a)=>{"use strict";a.d(t,{n:()=>o});var s=a(71620),r=a(50848),i=a(56489);let o=(0,s.v)()((0,r.Zr)((e,t)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,login:async(t,a)=>{e({isLoading:!0,error:null});try{let s=await i.Ay.loginUser(t,a);if(!s.success||!s.user)throw Error("Błąd logowania");let r=s.user,o={id:r.id,email:r.email,firstName:r.first_name||r.name?.split(" ")[0]||"",lastName:r.last_name||r.name?.split(" ").slice(1).join(" ")||"",role:"customer",billing:{address:r.billing?.address_1||"",city:r.billing?.city||"",postcode:r.billing?.postcode||"",country:r.billing?.country||"PL",phone:r.billing?.phone||"",company:r.billing?.company||"",nip:r.billing?.nip||""},shipping:{address:r.shipping?.address_1||"",city:r.shipping?.city||"",postcode:r.shipping?.postcode||"",country:r.shipping?.country||"PL"}},n=r.token;return e({user:o,token:n,isAuthenticated:!0,isLoading:!1,error:null}),!0}catch(t){return console.error("Login error:",t),e({error:"Błąd logowania. Sprawdź email i hasło.",isLoading:!1}),!1}},register:async t=>{e({isLoading:!0,error:null});try{let a=await i.Ay.registerUser({username:t.email,email:t.email,password:t.password,first_name:"",last_name:""});if(t.marketingConsent)try{await fetch("/api/newsletter/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,firstName:t.firstName,lastName:t.lastName,consent:!0,source:"registration"})})}catch(e){console.error("❌ Newsletter subscription error:",e)}if(!a.success||!a.user)throw Error("Błąd rejestracji");let s=a.user,r={id:s.id,email:s.email,firstName:t.firstName||"",lastName:t.lastName||"",role:"customer",billing:{address:"",city:"",postcode:"",country:"PL",phone:t.phone||""},shipping:{address:"",city:"",postcode:"",country:"PL"}},o="woo-user-token-"+s.id;return e({user:r,token:o,isAuthenticated:!0,isLoading:!1,error:null}),!0}catch(a){console.error("Registration error:",a);let t="Błąd rejestracji. Spr\xf3buj ponownie.";return a instanceof Error&&(t=a.message.includes("registration-error-email-exists")||a.message.includes("Email już istnieje")?"Ten adres email jest już zarejestrowany. Zaloguj się lub użyj innego adresu.":a.message.includes("400")?"Błąd rejestracji. Sprawdź wprowadzone dane i spr\xf3buj ponownie.":a.message),e({error:t,isLoading:!1}),!1}},logout:()=>{e({user:null,token:null,isAuthenticated:!1,error:null})},refreshToken:async()=>{let{token:e}=t();if(!e)return!1;try{return await new Promise(e=>setTimeout(e,500)),!0}catch(e){return console.error("Token refresh error:",e),t().logout(),!1}},updateUser:a=>{let{user:s}=t();s&&e({user:{...s,...a}})},updateProfile:async a=>{let{user:s}=t();if(!s?.id)return{success:!1,message:"Użytkownik nie jest zalogowany"};e({isLoading:!0,error:null});try{let r=await fetch("/api/woocommerce?endpoint=customer/update-profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_id:s.id,profile_data:a})}),i=await r.json();if(i.success){let{updateUser:a}=t();return a(i.customer),e({isLoading:!1,error:null}),{success:!0,message:i.message,customer:i.customer}}throw Error(i.error||"Nie udało się zaktualizować profilu")}catch(t){return e({isLoading:!1,error:t.message||"Wystąpił błąd podczas aktualizacji profilu"}),{success:!1,message:t.message||"Wystąpił błąd podczas aktualizacji profilu"}}},changePassword:async(a,s)=>{let{user:r}=t();if(!r?.id)return{success:!1,message:"Użytkownik nie jest zalogowany"};e({isLoading:!0,error:null});try{let t=await fetch("/api/woocommerce?endpoint=customer/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_id:r.id,current_password:a,new_password:s})}),i=await t.json();if(i.success)return e({isLoading:!1,error:null}),{success:!0,message:i.message};throw Error(i.error||"Nie udało się zmienić hasła")}catch(t){return e({isLoading:!1,error:t.message||"Wystąpił błąd podczas zmiany hasła"}),{success:!1,message:t.message||"Wystąpił błąd podczas zmiany hasła"}}},clearError:()=>{e({error:null})},setToken:t=>{e({token:t,isAuthenticated:!0})},clearToken:()=>{e({token:null,isAuthenticated:!1})},fetchUserProfile:async()=>{let{token:a,user:s}=t();if(a&&s)try{let t=await fetch("/api/woocommerce?endpoint=customers/"+s.id,{method:"GET",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw Error("Failed to fetch user profile");let r=await t.json(),i=r.meta_data?.find(e=>"billing_nip"===e.key),o=i?.value||"",n={id:r.id,email:r.email,firstName:r.first_name||"",lastName:r.last_name||"",role:"customer",billing:{address:r.billing?.address_1||"",city:r.billing?.city||"",postcode:r.billing?.postcode||"",country:r.billing?.country||"PL",phone:r.billing?.phone||"",company:r.billing?.company||"",nip:o},shipping:{address:r.shipping?.address_1||"",city:r.shipping?.city||"",postcode:r.shipping?.postcode||"",country:r.shipping?.country||"PL"}};e({user:n})}catch(e){console.error("❌ Error fetching user profile:",e)}}}),{name:"filler-auth-storage",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})}))}},e=>{e.O(0,[5355,4445,9391,7856,6489,587,18,7358],()=>e(e.s=10157)),_N_E=e.O()}]);