"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4321],{13719:(e,r,t)=>{t.d(r,{n:()=>o});var i=t(71620),a=t(50848),s=t(56489);let o=(0,i.v)()((0,a.Zr)((e,r)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,login:async(r,t)=>{e({isLoading:!0,error:null});try{let i=await s.Ay.loginUser(r,t);if(!i.success||!i.user)throw Error("Błąd logowania");let a=i.user,o={id:a.id,email:a.email,firstName:a.first_name||a.name?.split(" ")[0]||"",lastName:a.last_name||a.name?.split(" ").slice(1).join(" ")||"",role:"customer",billing:{address:a.billing?.address_1||"",city:a.billing?.city||"",postcode:a.billing?.postcode||"",country:a.billing?.country||"PL",phone:a.billing?.phone||"",company:a.billing?.company||"",nip:a.billing?.nip||""},shipping:{address:a.shipping?.address_1||"",city:a.shipping?.city||"",postcode:a.shipping?.postcode||"",country:a.shipping?.country||"PL"}},n=a.token;return e({user:o,token:n,isAuthenticated:!0,isLoading:!1,error:null}),!0}catch(r){return console.error("Login error:",r),e({error:"Błąd logowania. Sprawdź email i hasło.",isLoading:!1}),!1}},register:async r=>{e({isLoading:!0,error:null});try{let t=await s.Ay.registerUser({username:r.email,email:r.email,password:r.password,first_name:"",last_name:""});if(r.marketingConsent)try{await fetch("/api/newsletter/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r.email,firstName:r.firstName,lastName:r.lastName,consent:!0,source:"registration"})})}catch(e){console.error("❌ Newsletter subscription error:",e)}if(!t.success||!t.user)throw Error("Błąd rejestracji");let i=t.user,a={id:i.id,email:i.email,firstName:r.firstName||"",lastName:r.lastName||"",role:"customer",billing:{address:"",city:"",postcode:"",country:"PL",phone:r.phone||""},shipping:{address:"",city:"",postcode:"",country:"PL"}},o="woo-user-token-"+i.id;return e({user:a,token:o,isAuthenticated:!0,isLoading:!1,error:null}),!0}catch(t){console.error("Registration error:",t);let r="Błąd rejestracji. Spr\xf3buj ponownie.";return t instanceof Error&&(r=t.message.includes("registration-error-email-exists")||t.message.includes("Email już istnieje")?"Ten adres email jest już zarejestrowany. Zaloguj się lub użyj innego adresu.":t.message.includes("400")?"Błąd rejestracji. Sprawdź wprowadzone dane i spr\xf3buj ponownie.":t.message),e({error:r,isLoading:!1}),!1}},logout:()=>{e({user:null,token:null,isAuthenticated:!1,error:null})},refreshToken:async()=>{let{token:e}=r();if(!e)return!1;try{return await new Promise(e=>setTimeout(e,500)),!0}catch(e){return console.error("Token refresh error:",e),r().logout(),!1}},updateUser:t=>{let{user:i}=r();i&&e({user:{...i,...t}})},updateProfile:async t=>{let{user:i}=r();if(!i?.id)return{success:!1,message:"Użytkownik nie jest zalogowany"};e({isLoading:!0,error:null});try{let a=await fetch("/api/woocommerce?endpoint=customer/update-profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_id:i.id,profile_data:t})}),s=await a.json();if(s.success){let{updateUser:t}=r();return t(s.customer),e({isLoading:!1,error:null}),{success:!0,message:s.message,customer:s.customer}}throw Error(s.error||"Nie udało się zaktualizować profilu")}catch(r){return e({isLoading:!1,error:r.message||"Wystąpił błąd podczas aktualizacji profilu"}),{success:!1,message:r.message||"Wystąpił błąd podczas aktualizacji profilu"}}},changePassword:async(t,i)=>{let{user:a}=r();if(!a?.id)return{success:!1,message:"Użytkownik nie jest zalogowany"};e({isLoading:!0,error:null});try{let r=await fetch("/api/woocommerce?endpoint=customer/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_id:a.id,current_password:t,new_password:i})}),s=await r.json();if(s.success)return e({isLoading:!1,error:null}),{success:!0,message:s.message};throw Error(s.error||"Nie udało się zmienić hasła")}catch(r){return e({isLoading:!1,error:r.message||"Wystąpił błąd podczas zmiany hasła"}),{success:!1,message:r.message||"Wystąpił błąd podczas zmiany hasła"}}},clearError:()=>{e({error:null})},setToken:r=>{e({token:r,isAuthenticated:!0})},clearToken:()=>{e({token:null,isAuthenticated:!1})},fetchUserProfile:async()=>{let{token:t,user:i}=r();if(t&&i)try{let r=await fetch("/api/woocommerce?endpoint=customers/"+i.id,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!r.ok)throw Error("Failed to fetch user profile");let a=await r.json(),s=a.meta_data?.find(e=>"billing_nip"===e.key),o=s?.value||"",n={id:a.id,email:a.email,firstName:a.first_name||"",lastName:a.last_name||"",role:"customer",billing:{address:a.billing?.address_1||"",city:a.billing?.city||"",postcode:a.billing?.postcode||"",country:a.billing?.country||"PL",phone:a.billing?.phone||"",company:a.billing?.company||"",nip:o},shipping:{address:a.shipping?.address_1||"",city:a.shipping?.city||"",postcode:a.shipping?.postcode||"",country:a.shipping?.country||"PL"}};e({user:n})}catch(e){console.error("❌ Error fetching user profile:",e)}}}),{name:"filler-auth-storage",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})}))},43199:(e,r,t)=>{t.d(r,{x:()=>n});var i=t(71620),a=t(50848),s=t(56489),o=t(90011);let n=(0,i.v)()((0,a.Zr)((e,r)=>({items:[],isOpen:!1,total:0,itemCount:0,addItem:async t=>{try{let{items:i}=r(),a=i.findIndex(e=>e.id===t.id&&e.variant?.id===t.variant?.id);if(a>-1){let r=[...i];r[a].quantity+=t.quantity||1,e({items:r})}else{let r={...t,quantity:t.quantity||1};e({items:[...i,r]})}r().calculateTotal();try{(await s.Ay.addToCart(t.id,t.quantity||1,t.variant?{id:t.variant.id,attributes:t.attributes||{}}:void 0)).success}catch(e){}}catch(e){throw console.error("❌ Error adding item to cart:",e),e}},removeItem:async(t,i)=>{try{let{items:a}=r();if(a.find(e=>e.id===t&&(!i||e.variant?.id===i))){let s=a.filter(e=>!(e.id===t&&(!i||e.variant?.id===i)));e({items:s}),r().calculateTotal()}}catch(s){console.error("Error removing item from cart:",s);let{items:a}=r();e({items:a.filter(e=>!(e.id===t&&(!i||e.variant?.id===i)))}),r().calculateTotal()}},updateQuantity:async(t,i,a)=>{if(i<=0)return void await r().removeItem(t,a);try{let{items:s}=r(),o=s.map(e=>e.id!==t||a&&e.variant?.id!==a?e:{...e,quantity:i});e({items:o}),r().calculateTotal()}catch(o){console.error("Error updating item quantity:",o);let{items:s}=r();e({items:s.map(e=>e.id!==t||a&&e.variant?.id!==a?e:{...e,quantity:i})}),r().calculateTotal()}},clearCart:()=>{e({items:[],total:0,itemCount:0})},toggleCart:()=>{e(e=>({isOpen:!e.isOpen}))},openCart:()=>{e({isOpen:!0})},closeCart:()=>{e({isOpen:!1})},calculateTotal:()=>{let{items:t}=r();e({total:t.reduce((e,r)=>{let t=r.sale_price||r.price;return e+(0,o.FP)(t)*r.quantity},0),itemCount:t.reduce((e,r)=>e+r.quantity,0)})}}),{name:"filler-cart-storage",partialize:e=>({items:e.items,total:e.total,itemCount:e.itemCount}),onRehydrateStorage:()=>e=>{e?.items&&e.items.length>0&&e.calculateTotal()}}))},90011:(e,r,t)=>{function i(e){return new Intl.NumberFormat("pl-PL",{style:"currency",currency:"PLN",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function a(e){return 1.23*e}function s(e){return i(a(e))+" (z VAT)"}t.d(r,{$g:()=>i,FP:()=>a,mF:()=>s})}}]);