(()=>{var a={};a.id=254,a.ids=[254],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},23620:(a,b,c)=>{"use strict";Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(36028),e=c(73789),f=c(29790);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},26121:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>T,patchFetch:()=>S,routeModule:()=>O,serverHooks:()=>R,workAsyncStorage:()=>P,workUnitAsyncStorage:()=>Q});var d={};c.r(d),c.d(d,{GET:()=>M,POST:()=>N});var e=c(26421),f=c(97714),g=c(85681),h=c(22369),i=c(37587),j=c(261),k=c(46537),l=c(3463),m=c(1889),n=c(85250),o=c(23620),p=c(29790),q=c(67876),r=c(57749),s=c(86439),t=c(40139),u=c(53444),v=c(34484);let w=void 0,x=process.env.WOOCOMMERCE_API_URL,y=x?x.replace(/\/wp-json\/wc\/v3.*/,""):"",z=process.env.WOOCOMMERCE_CONSUMER_KEY,A=process.env.WOOCOMMERCE_CONSUMER_SECRET;async function B(a){let{email:b}=a;if(!b)return u.NextResponse.json({success:!1,error:"Email jest wymagany"},{status:400});try{let a=await fetch("https://qvwltjhdjw.cfolks.pl/wp-json/custom/v1/password-reset",{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"Mozilla/5.0 (compatible; HeadlessWoo/1.0)"},body:JSON.stringify({email:b})});if(a.ok){let b=await a.json();return u.NextResponse.json({success:b.success,message:b.message,debug_info:b.debug_info})}{await a.text();let c="Basic "+Buffer.from("ck_deb61eadd7300ebfc5f8074ce7c53c6668eb725d:cs_0de18ed0e013f96aebfb51c77f506bb94e416cb8").toString("base64"),d=await fetch(`https://qvwltjhdjw.cfolks.pl/wp-json/wc/v3/customers?email=${encodeURIComponent(b)}`,{method:"GET",headers:{Authorization:c,"Content-Type":"application/json","User-Agent":"Mozilla/5.0 (compatible; HeadlessWoo/1.0)"}});if(d.ok&&(await d.json()).length>0)return u.NextResponse.json({success:!0,message:"Użytkownik został znaleziony. Ze względ\xf3w bezpieczeństwa, skontaktuj się z obsługą klienta w celu resetowania hasła."});return u.NextResponse.json({success:!0,message:"Jeśli podany email istnieje w systemie, otrzymasz link do resetowania hasła."})}}catch(a){return console.error("\uD83D\uDEA8 Password reset error:",a),u.NextResponse.json({success:!0,message:"Jeśli podany email istnieje w systemie, otrzymasz link do resetowania hasła."})}}async function C(a){let{key:b,login:c,password:d}=a;if(!b||!c||!d)return u.NextResponse.json({success:!1,error:"Wszystkie pola są wymagane"},{status:400});try{let a=await fetch("https://qvwltjhdjw.cfolks.pl/wp-json/custom/v1/reset-password",{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"Mozilla/5.0 (compatible; HeadlessWoo/1.0)"},body:JSON.stringify({key:b,login:c,password:d})});if(a.ok)return await a.json(),u.NextResponse.json({success:!0,message:"Hasło zostało pomyślnie zresetowane"});return u.NextResponse.json({success:!1,error:"Nieprawidłowy lub wygasły klucz resetujący"},{status:400})}catch(a){return console.error("\uD83D\uDEA8 Password reset confirm error:",a),u.NextResponse.json({success:!1,error:"Wystąpił błąd podczas resetowania hasła"},{status:500})}}async function D(a){let{searchParams:b}=new URL(a.url),c=b.get("customer_id");if(!c)return u.NextResponse.json({success:!1,error:"Customer ID jest wymagany"},{status:400});try{let a=`https://qvwltjhdjw.cfolks.pl/wp-json/custom/v1/invoices?customer_id=${c}`,b=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":"Mozilla/5.0 (compatible; HeadlessWoo/1.0)"}}),d=await b.text(),e=null;try{e=d?JSON.parse(d):null}catch(a){}if(!b.ok){let a=e&&(e.error||e.message)||d||"Błąd pobierania faktur";return u.NextResponse.json({success:!1,error:String(a).slice(0,1e3)},{status:b.status||502})}if(!e)return u.NextResponse.json({success:!0,invoices:[]});let f=(Array.isArray(e.invoices)?e.invoices:[]).map(a=>{let b=a.id||a.order_id,c=a.download_url&&"string"==typeof a.download_url&&a.download_url.length>0,d=b?`${y}/?action=generate_wpo_wcpdf&document_type=invoice&order_ids=${b}`:void 0;return{...a,download_url:c?a.download_url:d}});return u.NextResponse.json({success:!0,invoices:f})}catch(a){return console.error("\uD83D\uDEA8 Error fetching customer invoices:",a),u.NextResponse.json({success:!1,error:"Nie udało się pobrać faktur"},{status:500})}}async function E(a){let{searchParams:b}=new URL(a.url),c=b.get("order_id");if(!c)return u.NextResponse.json({success:!1,error:"Order ID jest wymagany"},{status:400});try{let a=`https://qvwltjhdjw.cfolks.pl/wp-json/custom/v1/tracking/${c}`,b=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":"Mozilla/5.0 (compatible; HeadlessWoo/1.0)"}}),d=await b.text(),e=null;try{e=d?JSON.parse(d):null}catch(a){}if(!b.ok){let a=e&&(e.error||e.message)||d||"Błąd pobierania śledzenia";return u.NextResponse.json({success:!1,error:String(a).slice(0,1e3)},{status:b.status||502})}if(!e)return u.NextResponse.json({success:!0,tracking:{}});return u.NextResponse.json({success:!0,tracking:e.tracking||{}})}catch(a){return console.error("\uD83D\uDEA8 Error fetching order tracking:",a),u.NextResponse.json({success:!1,error:"Nie udało się pobrać informacji o śledzeniu"},{status:500})}}async function F(a){let{customer_id:b,profile_data:c}=a;if(!b||!c)return u.NextResponse.json({success:!1,error:"Customer ID i dane profilu są wymagane"},{status:400});try{let a=null;try{let d=await fetch("https://qvwltjhdjw.cfolks.pl/wp-json/custom/v1/customer/update-profile",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":"Mozilla/5.0 (compatible; HeadlessWoo/1.0)"},body:JSON.stringify({customer_id:b,profile_data:c})}),e=await d.text(),f=null;try{f=e?JSON.parse(e):null}catch(a){}d.ok&&f&&f.success&&(a=f.customer||null)}catch(a){}if(!x||!z||!A)return u.NextResponse.json({success:!1,error:"Brak konfiguracji WooCommerce API"},{status:500});let d={first_name:c.firstName,last_name:c.lastName,billing:{first_name:c.firstName,last_name:c.lastName,company:c.billing?.company||"",phone:c.billing?.phone||"",address_1:c.billing?.address||"",city:c.billing?.city||"",postcode:c.billing?.postcode||"",country:c.billing?.country||"PL",email:void 0},shipping:{first_name:c.firstName,last_name:c.lastName,company:c.shipping?.company||"",address_1:c.shipping?.address||"",city:c.shipping?.city||"",postcode:c.shipping?.postcode||"",country:c.shipping?.country||"PL"},meta_data:[]},e=c.billing?.nip||c.nip,f=c.billing?.invoiceRequest??c.invoiceRequest;void 0!==e&&d.meta_data.push({key:"_billing_nip",value:String(e)}),void 0!==f&&d.meta_data.push({key:"_invoice_request",value:f?"yes":"no"});let g=`${x}/customers/${b}?consumer_key=${z}&consumer_secret=${A}`,h=await fetch(g,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":"Mozilla/5.0 (compatible; HeadlessWoo/1.0)"},body:JSON.stringify(d)}),i=await h.text(),j=null;try{j=i?JSON.parse(i):null}catch(a){}if(!h.ok){let a=j&&(j.error||j.message)||i||"Błąd aktualizacji klienta w WooCommerce";return u.NextResponse.json({success:!1,error:String(a).slice(0,1e3)},{status:h.status||502})}let k=a||j;return u.NextResponse.json({success:!0,message:"Profil został zaktualizowany",customer:k})}catch(a){return console.error("\uD83D\uDEA8 Error updating customer profile:",a),u.NextResponse.json({success:!1,error:a.message||"Nie udało się zaktualizować profilu"},{status:500})}}async function G(a){let{customer_id:b,current_password:c,new_password:d}=a;if(!b||!c||!d)return u.NextResponse.json({success:!1,error:"Wszystkie pola są wymagane"},{status:400});try{let a=await fetch("https://qvwltjhdjw.cfolks.pl/wp-json/custom/v1/customer/change-password",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":"Mozilla/5.0 (compatible; HeadlessWoo/1.0)"},body:JSON.stringify({customer_id:b,current_password:c,new_password:d})}),e=await a.text(),f=null;try{f=e?JSON.parse(e):null}catch(a){}if(!a.ok){let b=404===a.status?"Funkcja zmiany hasła nie jest jeszcze dostępna. Skontaktuj się z administratorem.":f&&(f.error||f.message)||e||"Błąd zmiany hasła";return u.NextResponse.json({success:!1,error:String(b).slice(0,1e3)},{status:a.status||502})}if(!f)return u.NextResponse.json({success:!0,message:"Hasło zostało zmienione"});return u.NextResponse.json({success:!0,message:f.message})}catch(a){return console.error("\uD83D\uDEA8 Error changing customer password:",a),u.NextResponse.json({success:!1,error:a.message||"Nie udało się zmienić hasła"},{status:500})}}async function H(a){let{billing:b,shipping:c,line_items:d,payment_method:e,payment_method_title:f,shipping_lines:g,customer_id:h,coupon_lines:i,meta_data:j}=a;if(!b||!d||!e)return u.NextResponse.json({success:!1,error:"Brakuje wymaganych danych zam\xf3wienia"},{status:400});try{let a={payment_method:e,payment_method_title:f||e,set_paid:!1,customer_id:h,billing:{first_name:b.firstName,last_name:b.lastName,email:b.email,phone:b.phone,company:b.company||"",address_1:b.address,city:b.city,state:"",postcode:b.postcode,country:b.country||"PL"},shipping:c?{first_name:c.firstName,last_name:c.lastName,company:c.company||"",address_1:c.address,city:c.city,state:"",postcode:c.postcode,country:c.country||"PL"}:{first_name:b.firstName,last_name:b.lastName,company:b.company||"",address_1:b.address,city:b.city,state:"",postcode:b.postcode,country:b.country||"PL"},line_items:d.map(a=>({product_id:a.product_id,variation_id:a.variation_id||0,quantity:a.quantity,meta_data:a.meta_data||[]})),shipping_lines:g||[],coupon_lines:i||[],meta_data:[...j||[],{key:"_created_via",value:"headless-woo"},{key:"_order_version",value:"1.0.0"}]},k=`${x}/orders?consumer_key=${z}&consumer_secret=${A}`,l=await fetch(k,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":"Mozilla/5.0 (compatible; HeadlessWoo/1.0)"},body:JSON.stringify(a)}),m=await l.text(),n=null;try{n=m?JSON.parse(m):null}catch(a){}if(!l.ok){let a=n&&(n.message||n.error)||m||"Błąd tworzenia zam\xf3wienia";return u.NextResponse.json({success:!1,error:String(a).slice(0,1e3)},{status:l.status||502})}if(!n)return u.NextResponse.json({success:!1,error:"Nie udało się utworzyć zam\xf3wienia"},{status:500});try{let a=`${x}/wp-json/king-email/v1/trigger-order-email`,b=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({order_id:n.id})});b.ok&&await b.json()}catch(a){console.error("❌ Error triggering emails:",a)}return u.NextResponse.json({success:!0,order:{id:n.id,number:n.number,status:n.status,total:n.total,currency:n.currency,payment_url:n.payment_url,checkout_payment_url:n.checkout_payment_url,date_created:n.date_created,billing:n.billing,shipping:n.shipping,line_items:n.line_items}})}catch(a){return console.error("\uD83D\uDEA8 Error creating order:",a),u.NextResponse.json({success:!1,error:a.message||"Nie udało się utworzyć zam\xf3wienia"},{status:500})}}async function I(a){let{searchParams:b}=new URL(a.url);if(!x||!z||!A)return u.NextResponse.json({error:"Błąd konfiguracji serwera",details:"Brakuje zmiennych środowiskowych WooCommerce"},{status:500});try{let a=`https://qvwltjhdjw.cfolks.pl/wp-json/king-shop/v1/attributes?${b.toString()}`,c=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":"Filler-Store/1.0"},cache:"no-store"});if(!c.ok)throw Error(`HTTP error! status: ${c.status}`);let d=await c.json();return u.NextResponse.json(d,{status:200,headers:{"content-type":"application/json","Cache-Control":"public, max-age=60, s-maxage=120, stale-while-revalidate=300","X-Cache":"MISS"}})}catch(a){return console.error("❌ Attributes endpoint error:",a),u.NextResponse.json({error:"Nie udało się pobrać atrybut\xf3w",details:a instanceof Error?a.message:"Nieznany błąd"},{status:500})}}async function J(a){let{searchParams:b}=new URL(a.url);if(!x||!z||!A)return u.NextResponse.json({error:"Błąd konfiguracji serwera",details:"Brakuje zmiennych środowiskowych WooCommerce"},{status:500});try{let a=`https://qvwltjhdjw.cfolks.pl/wp-json/king-shop/v1/data?${b.toString()}`,c=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":"Filler-Store/1.0"},cache:"no-store"});if(!c.ok)throw Error(`HTTP error! status: ${c.status}`);let d=await c.json();return u.NextResponse.json(d,{status:200,headers:{"content-type":"application/json","Cache-Control":"public, max-age=60, s-maxage=120, stale-while-revalidate=300","X-Cache":"MISS"}})}catch(a){return console.error("❌ Shop endpoint error:",a),u.NextResponse.json({error:"Nie udało się pobrać danych sklepu",details:a instanceof Error?a.message:"Nieznany błąd"},{status:500})}}async function K(a){let{searchParams:b}=new URL(a.url),c=b.get("country")||"PL",d=b.get("state")||"",e=b.get("city")||"",f=b.get("postcode")||"";if(!x||!z||!A)return u.NextResponse.json({error:"Błąd konfiguracji serwera",details:"Brakuje zmiennych środowiskowych WooCommerce"},{status:500});try{let a,b=`${x}/shipping/zones?consumer_key=${z}&consumer_secret=${A}`,g=await fetch(b,{headers:{Accept:"application/json","User-Agent":"Filler-Store/1.0"}});if(!g.ok)throw Error(`Nie udało się pobrać stref wysyłki: ${g.status}`);let h=await g.text();try{a=JSON.parse(h)}catch(b){console.error("Shipping zones returned non-JSON (truncated):",h.substring(0,200)),a=[]}let i=Array.isArray(a)?a:[],j=[];for(let a of i){let b=`${x}/shipping/zones/${a.id}/methods?consumer_key=${z}&consumer_secret=${A}`,c=await fetch(b);if(c.ok){let b=await c.text(),d=[];try{d=await JSON.parse(b)}catch(a){try{let a=b.replace(/"method_description"\s*:\s*"[\s\S]*?"(?=,|\}|\])/g,'"method_description":""').replace(/"method_title"\s*:\s*"([\s\S]*?)"/g,(a,b)=>{let c=String(b).replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim();return`"method_title":"${c}"`});d=JSON.parse(a)}catch(a){console.error("Nie udało się bezpiecznie sparsować metod wysyłki:",a),d=[]}}for(let b of d)b.enabled&&j.push({id:b.id,method_id:b.method_id,title:b.title,cost:b.cost||"0",zone_id:a.id,zone_name:a.name,method_title:b.method_title||b.title,method_description:b.method_description||"",settings:b.settings||{},zone_locations:a.locations||[]})}}let k=j.map(a=>{var b;let c=0,d=0;if("flexible_shipping_single"===a.method_id){let b=a.settings||{};if(b.method_free_shipping&&b.method_free_shipping.value&&(d=parseFloat(b.method_free_shipping.value)),b.method_rules&&b.method_rules.value&&b.method_rules.value.length>0){let a=b.method_rules.value;a[0]&&a[0].cost_per_order&&(c=parseFloat(a[0].cost_per_order))}}else if("flat_rate"===a.method_id){let b=a.settings||{};b.cost&&b.cost.value&&(c=parseFloat(b.cost.value))}return{id:a.id,method_id:a.method_id,method_title:a.settings?.method_title?.value||a.method_title,method_description:(b=a.settings?.method_description?.value||a.method_description)?b.replace(/<[^>]*>/g,"").replace(/&rarr;/g,"→").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').trim():"",cost:c,free_shipping_threshold:d,zone_id:a.zone_id,zone_name:a.zone_name,settings:a.settings}}),l=Array.isArray(k)&&k.length>0?k:[{id:"free_shipping_default",method_id:"free_shipping",method_title:"Darmowa dostawa",method_description:"",cost:0,free_shipping_threshold:0,zone_id:0,zone_name:"Domyślna",settings:{}},{id:"flat_rate_default",method_id:"flat_rate",method_title:"Dostawa standardowa",method_description:"",cost:15,free_shipping_threshold:0,zone_id:0,zone_name:"Domyślna",settings:{}},{id:"local_pickup_default",method_id:"local_pickup",method_title:"Odbi\xf3r osobisty",method_description:"",cost:0,free_shipping_threshold:0,zone_id:0,zone_name:"Domyślna",settings:{}}];return u.NextResponse.json({success:!0,shipping_methods:l,country:c,state:d,city:e,postcode:f})}catch(a){return console.error("Shipping methods API error:",a),u.NextResponse.json({error:"Nie udało się pobrać metod wysyłki",details:a instanceof Error?a.message:String(a)},{status:500})}}async function L(a){try{let{searchParams:b}=new URL(a.url),c=b.get("code");if(!x||!z||!A)return u.NextResponse.json({error:"Brak konfiguracji WooCommerce"},{status:500});if(c){let a=await fetch(`${x}/coupons?code=${encodeURIComponent(c)}&status=active`,{headers:{Authorization:`Basic ${Buffer.from(`${z}:${A}`).toString("base64")}`}});if(!a.ok)return u.NextResponse.json({error:"Nieprawidłowy kod rabatowy"},{status:400});let b=await a.json();if(0===b.length)return u.NextResponse.json({error:"Nieprawidłowy kod rabatowy"},{status:400});let d=b[0];if(d.usage_limit&&d.usage_count>=d.usage_limit)return u.NextResponse.json({error:"Kod rabatowy został już wykorzystany"},{status:400});if(d.date_expires&&new Date(d.date_expires)<new Date)return u.NextResponse.json({error:"Kod rabatowy wygasł"},{status:400});return d.usage_limit_per_user&&d.usage_limit_per_user,u.NextResponse.json({success:!0,coupon:{id:d.id,code:d.code,discount_type:d.discount_type,amount:parseFloat(d.amount),minimum_amount:d.minimum_amount?parseFloat(d.minimum_amount):null,maximum_amount:d.maximum_amount?parseFloat(d.maximum_amount):null,usage_limit:d.usage_limit,usage_count:d.usage_count,date_expires:d.date_expires}})}let d=await fetch(`${x}/coupons?status=active&_fields=id,code,discount_type,amount,minimum_amount,maximum_amount,usage_limit,usage_count,date_expires`,{headers:{Authorization:`Basic ${Buffer.from(`${z}:${A}`).toString("base64")}`}}),e=await d.json();return u.NextResponse.json({success:!0,coupons:e.map(a=>({id:a.id,code:a.code,discount_type:a.discount_type,amount:parseFloat(a.amount),minimum_amount:a.minimum_amount?parseFloat(a.minimum_amount):null,maximum_amount:a.maximum_amount?parseFloat(a.maximum_amount):null,usage_limit:a.usage_limit,usage_count:a.usage_count,date_expires:a.date_expires}))})}catch(a){return console.error("Coupons API error:",a),u.NextResponse.json({error:"Nie udało się pobrać kupon\xf3w",details:a instanceof Error?a.message:String(a)},{status:500})}}async function M(a){let{searchParams:b}=new URL(a.url),c=b.get("endpoint")||"products",d="off"===b.get("cache");if(c.startsWith("king-optimized/product/")){let a=c.replace("king-optimized/product/",""),b=`https://qvwltjhdjw.cfolks.pl/wp-json/king-optimized/v1/product/${a}`;try{let a=await fetch(b,{headers:{Accept:"application/json"},cache:d?"no-store":"default"});if(!a.ok)return u.NextResponse.json({success:!1,error:"Product not found"},{status:a.status});let c=await a.json();return u.NextResponse.json(c)}catch(a){return u.NextResponse.json({success:!1,error:a.message},{status:500})}}if(c.startsWith("customers/")){let b=c.replace("customers/",""),d=a.headers.get("authorization");if(!d||!d.startsWith("Bearer "))return u.NextResponse.json({error:"Unauthorized"},{status:401});try{let a=await fetch(`${x}/customers/${b}?consumer_key=${z}&consumer_secret=${A}`,{headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!a.ok){let b=await a.text();return console.error("❌ Customer API error:",b),u.NextResponse.json({error:"Customer not found"},{status:a.status})}let c=await a.json();return u.NextResponse.json(c)}catch(a){return console.error("❌ Customer fetch error:",a),u.NextResponse.json({error:a.message},{status:500})}}if("payment_gateways"===c){if(!x||!z||!A)return u.NextResponse.json({success:!1,error:"Brak konfiguracji WooCommerce API"},{status:500});try{let a=`${x}/payment_gateways?consumer_key=${z}&consumer_secret=${A}`,b=await fetch(a,{headers:{Accept:"application/json","User-Agent":"Filler-Store/1.0"},cache:"no-store"}),c=await b.text(),d=null;try{d=c?JSON.parse(c):null}catch(a){}if(!b.ok){let a=d&&(d.message||d.error)||c||"Błąd pobierania metod płatności";return u.NextResponse.json({success:!1,error:String(a).slice(0,1e3)},{status:b.status||502})}return u.NextResponse.json({success:!0,gateways:Array.isArray(d)?d:[]})}catch(a){return u.NextResponse.json({success:!1,error:a instanceof Error?a.message:String(a)},{status:502})}}if("shipping_methods"===c)return K(a);if("coupons"===c)return L(a);if("attributes"===c)return I(a);if("shop"===c)return J(a);if(!x||!z||!A)return u.NextResponse.json({error:"Błąd konfiguracji serwera",details:"Brakuje zmiennych środowiskowych WooCommerce"},{status:500});let e=a.headers.get("x-forwarded-for")||a.headers.get("x-real-ip")||"unknown",f=v.P.checkRateLimit(e);if(!f.allowed)return u.NextResponse.json({error:"Przekroczono limit zapytań",retryAfter:Math.ceil((f.resetAt-Date.now())/1e3)},{status:429,headers:{"Retry-After":Math.ceil((f.resetAt-Date.now())/1e3).toString(),"X-RateLimit-Limit":"100","X-RateLimit-Remaining":"0","X-RateLimit-Reset":f.resetAt.toString()}});let g=new URL(`${x.replace(/\/$/,"")}/${c}`);b.forEach((a,b)=>{"endpoint"!==b&&"cache"!==b&&g.searchParams.set(b,a)}),g.searchParams.set("consumer_key",z||""),g.searchParams.set("consumer_secret",A||"");try{let a=v.P.generateKey(g.toString()),b=null;if(d||(b=await v.P.get(a)),b)return new u.NextResponse(b.body,{status:200,headers:{"content-type":"application/json","Cache-Control":"public, max-age=30, s-maxage=60",ETag:b.etag,"X-Cache":"HIT","X-RateLimit-Limit":"100","X-RateLimit-Remaining":f.remaining.toString(),"X-RateLimit-Reset":f.resetAt.toString(),...b.headers}});let c=null;for(let b=1;b<=3;b++)try{let c=await fetch(g.toString(),{headers:{Accept:"application/json","User-Agent":"Filler-Store/1.0"},cache:"no-store"}),e=await c.text();if(!c.ok)return new u.NextResponse(e||c.statusText,{status:c.status,headers:{"content-type":c.headers.get("content-type")||"text/plain"}});if(e.trim().startsWith("<!DOCTYPE html>")||e.trim().startsWith("<html")){if(!d&&w&&"function"==typeof w.get)try{let b=await w.get(a);if(b)return new u.NextResponse(b,{status:200,headers:{"content-type":"application/json"}})}catch{}let b=await fetch(g,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":"Filler-Store/1.0"},cache:"no-store"});if(b.ok){let a=await b.text();if(!a.trim().startsWith("<!DOCTYPE html>")&&!a.trim().startsWith("<html"))return new u.NextResponse(a,{status:200,headers:{"content-type":"application/json"}})}let c={data:[],total:0,totalPages:0,currentPage:1,perPage:10,error:"API tymczasowo niedostępne"};return new u.NextResponse(JSON.stringify(c),{status:200,headers:{"content-type":"application/json"}})}d||await v.P.set(a,e,6e4,{"X-Response-Time":`${Date.now()-Date.now()}ms`,"X-Attempt":b.toString()});let h=v.P.generateETag(e);return new u.NextResponse(e,{status:200,headers:{"content-type":"application/json","Cache-Control":"public, max-age=30, s-maxage=60",ETag:h,"X-Cache":d?"BYPASS":"MISS","X-RateLimit-Limit":"100","X-RateLimit-Remaining":f.remaining.toString(),"X-RateLimit-Reset":f.resetAt.toString()}})}catch(a){c=a,b<3&&await new Promise(a=>setTimeout(a,1e3*b))}throw c}catch(a){return console.error("\uD83D\uDEA8 All attempts failed:",a),u.NextResponse.json({error:"Błąd serwera proxy",message:a instanceof Error?a.message:String(a)},{status:502})}}async function N(a){let{searchParams:b}=new URL(a.url),c=b.get("endpoint")||"products";try{let b=await a.json();if("customers/password-reset"===c)return await B(b);if("customers/reset-password"===c)return await C(b);if("customers/invoices"===c)return await D(a);if("orders"===c)return await H(b);if("orders/tracking"===c)return await E(a);if("customer/update-profile"===c)return await F(b);if("customer/change-password"===c)return await G(b);if("customers/invoices"===c)return await D(a);let d=new URL(`${x?.replace(/\/$/,"")||"https://qvwltjhdjw.cfolks.pl/wp-json/wc/v3"}/${c}`);d.searchParams.set("consumer_key",z||""),d.searchParams.set("consumer_secret",A||"");let e=null;for(let a=1;a<=3;a++)try{let a=await fetch(d.toString(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","User-Agent":"Filler-Store/1.0"},body:JSON.stringify(b),cache:"no-store"}),c=await a.text();if(!a.ok)return new u.NextResponse(c||a.statusText,{status:a.status,headers:{"content-type":a.headers.get("content-type")||"text/plain"}});return new u.NextResponse(c,{status:200,headers:{"content-type":"application/json"}})}catch(b){e=b,a<3&&await new Promise(b=>setTimeout(b,1e3*a))}throw e}catch(a){return console.error("\uD83D\uDEA8 POST All attempts failed:",a),u.NextResponse.json({error:"Błąd serwera proxy",message:a instanceof Error?a.message:String(a)},{status:502})}}let O=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/woocommerce/route",pathname:"/api/woocommerce",filename:"route",bundlePath:"app/api/woocommerce/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/kingbrand/Desktop/headless-woo/apps/web/src/app/api/woocommerce/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:P,workUnitAsyncStorage:Q,serverHooks:R}=O;function S(){return(0,g.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:Q})}async function T(a,b,c){var d;let e="/api/woocommerce/route";"/index"===e&&(e="/");let g=await O.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let F=null;!E||O.isDev||x||(F="/index"===(F=C)?"/":F);let G=!0===O.isDev||!E,H=E&&!G,I=a.method||"GET",J=(0,i.getTracer)(),K=J.getActiveScopeSpan(),L={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>O.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},M=new k.NodeNextRequest(a),N=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(M,(0,l.signalFromNodeResponse)(b));try{let d=async c=>O.handle(P,L).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=J.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${I} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${I} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=L.renderOpts.fetchMetrics;let i=L.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=L.renderOpts.collectedTags;if(!E)return await (0,o.I)(M,N,e,L.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,d=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await O.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})},z),b}},l=await O.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(M,N,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};K?await g(K):await J.withPropagatedContext(a.headers,()=>J.trace(m.BaseServerSpan.handleRequest,{spanName:`${I} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":I,"http.target":a.url}},g))}catch(b){if(K||b instanceof s.NoFallbackError||await O.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(M,N,new Response(null,{status:500})),null}}},26421:(a,b,c)=>{"use strict";a.exports=c(44870)},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34484:(a,b,c)=>{"use strict";c.d(b,{P:()=>i});let d=require("crypto");var e=c.n(d);let f=new Map,g=new Map;class h{static getInstance(){return h.instance||(h.instance=new h),h.instance}generateKey(a,b="GET"){return`cache:${b}:${e().createHash("md5").update(a).digest("hex")}`}generateETag(a){return`"${e().createHash("md5").update(a).digest("hex").slice(0,16)}"`}async get(a){let b=f.get(a);return b?Date.now()>b.expiresAt?(f.delete(a),null):{body:b.body,etag:b.etag,headers:b.headers}:null}async set(a,b,c=6e4,d={}){let e=this.generateETag(b);if(f.size>=1e3){let a=f.keys().next().value;a&&f.delete(a)}f.set(a,{body:b,expiresAt:Date.now()+c,etag:e,headers:d})}async delete(a){f.delete(a)}async clear(){f.clear()}async purge(a){let b=0;for(let c of f.keys())c.includes(a)&&(f.delete(c),b++);return b}checkRateLimit(a){let b=Date.now(),c=`rate:${a}`,d=g.get(c);return!d||b>d.resetAt?(g.set(c,{count:1,resetAt:b+6e4}),{allowed:!0,remaining:99,resetAt:b+6e4}):d.count>=100?{allowed:!1,remaining:0,resetAt:d.resetAt}:(d.count++,{allowed:!0,remaining:100-d.count,resetAt:d.resetAt})}getStats(){return{size:f.size,entries:f.size,rateLimitEntries:g.size}}}let i=h.getInstance()},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},80408:()=>{},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},87032:()=>{}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[635,444],()=>b(b.s=26121));module.exports=c})();